# ⚡ **Real-Time Analytics in Microsoft Fabric (KQL Database)**

---

## 🧭 **Introduction**

**Real-Time Analytics** in Microsoft Fabric allows you to ingest, process, and analyze **streaming data** with minimal latency.

Fabric achieves this using **KQL (Kusto Query Language) Databases**, a powerful tool designed for:

* **High-speed ingestion** of streaming and time-series data
* **Interactive querying** using KQL
* **Real-time dashboards, monitoring, and alerts**

KQL Databases are integrated into Fabric, enabling **analytics on data streams** from IoT devices, logs, application telemetry, or event streams, and they feed insights directly into **Power BI or dashboards**.

---

## 🔹 **1. Streaming Data Ingestion**

### **Overview**

Streaming data ingestion allows data to flow into the KQL Database continuously, supporting **high-velocity, high-volume data**.

**Common sources:**

* IoT sensors (temperature, vibration, etc.)
* Application logs (web apps, microservices)
* Telemetry from machines or equipment
* Event hubs, Kafka, or Azure Event Grid

**Ingestion methods in Fabric:**

* **Streaming pipelines** from **Data Factory** or **Event Hubs**
* Direct ingestion into **KQL Tables**
* **Delta lake integration** for hybrid real-time and batch processing

---

### **Diagram: Real-Time Streaming Ingestion**

```
[IoT Devices / Apps / Logs] 
         │
         ▼
+-------------------------+
| Event Hub / Kafka / API  |
+-------------------------+
         │
         ▼
+-------------------------+
| KQL Database (Fabric)   |
| Tables: SensorData      |
+-------------------------+
```

**Key Characteristics:**

* Fast ingestion (milliseconds latency)
* Optimized for append-only operations
* Supports **time-series tables** and **partitioned ingestion**
* Retains recent data efficiently for queries and alerts

---

### **Example**

Suppose you have IoT temperature sensors reporting data every second.

**KQL Table Definition**

```kql
.create table TemperatureData
(
    DeviceId: string,
    Timestamp: datetime,
    Temperature: real
)
```

**Streaming ingestion pipeline** ingests events every second into the `TemperatureData` table.

---

## 🔹 **2. Using Kusto Query Language (KQL)**

KQL is a **read-optimized query language** for **real-time analytics**, designed for:

* Ad hoc queries on streaming and batch data
* Aggregations, filtering, joins, and time-series analytics
* Fast querying over large datasets

---

### **Basic KQL Examples**

**1. Query latest readings from all devices**

```kql
TemperatureData
| summarize LatestTemp=max(Temperature) by DeviceId
```

**2. Average temperature in the last 10 minutes**

```kql
TemperatureData
| where Timestamp > ago(10m)
| summarize AvgTemp=avg(Temperature) by DeviceId
```

**3. Identify devices exceeding threshold**

```kql
TemperatureData
| where Temperature > 80
| project DeviceId, Temperature, Timestamp
```

**4. Time-series trend**

```kql
TemperatureData
| summarize AvgTemp=avg(Temperature) by bin(Timestamp, 1m), DeviceId
| render timechart
```

---

### **Diagram: KQL Query Flow**

```
[TemperatureData Table]
         │
         ▼
     [KQL Query]
         │
  ┌──────┴────────┐
  │ Aggregation   │
  │ Filtering     │
  │ Time-Series   │
  └──────┬────────┘
         ▼
[Results / Visualization / Alerts]
```

---

## 🔹 **3. Real-Time Dashboards and Alerts**

Fabric integrates KQL databases directly with **Power BI and Fabric dashboards**, enabling:

* **Live dashboards** for monitoring streaming metrics
* **Alerts** when certain conditions are met (threshold breaches, anomalies)
* **Automated notifications** via Data Activator or email/webhooks

---

### **Creating Real-Time Dashboard**

1. Connect Power BI to the **KQL Database**.
2. Use **DirectQuery** mode for live updates.
3. Build visuals (line charts, gauges) on **time-series data**.
4. Configure alerts:

   * Example: Temperature > 80°C triggers alert
   * Action: Notify maintenance team via Data Activator

---

### **Example: Alert with KQL**

```kql
TemperatureData
| where Temperature > 80
| summarize count() by DeviceId, bin(Timestamp, 1m)
| where count_ > 0
```

This query can feed into **Fabric Data Activator** to trigger automated alerts.

---

### **Diagram: Real-Time Analytics Architecture**

```
[IoT / Event Streams]
          │
          ▼
[Streaming Ingestion Pipeline]
          │
          ▼
+-------------------------+
| KQL Database            |
| (Real-Time Analytics)   |
+-------------------------+
          │
          ▼
+-------------------------+
| Power BI / Fabric Dash  |
| Live Visualization      |
+-------------------------+
          │
          ▼
+-------------------------+
| Alerts / Automation     |
| (Data Activator)        |
+-------------------------+
```

---

## 🔹 **4. Example Scenario**

**Scenario:** Predictive monitoring for a factory machine.

1. **Sensors** send temperature and vibration data to Event Hub.
2. **Streaming ingestion** loads this into the KQL Database.
3. **KQL Queries** compute:

   * Average temperature per machine per minute
   * Anomalies when thresholds are exceeded
4. **Power BI dashboards** show real-time metrics.
5. **Alerts** via Data Activator notify maintenance when anomalies are detected.

---

## 🧠 **Summary**

| Concept                  | Description                                                             |
| ------------------------ | ----------------------------------------------------------------------- |
| **KQL Database**         | Real-time, scalable database for streaming & time-series data in Fabric |
| **Streaming ingestion**  | High-velocity ingestion pipeline for IoT/events/logs                    |
| **Kusto Query Language** | Query language optimized for real-time analytics                        |
| **Real-time dashboards** | Power BI/Fabric dashboards for monitoring live metrics                  |
| **Alerts & Automation**  | Trigger notifications and automated actions via Data Activator          |

---

## ❓ **Practice Questions & Answers**

**Q1.** What is the purpose of a KQL Database in Fabric?
**A1.** It is used for real-time analytics, time-series data, and streaming data processing.

**Q2.** Name two common streaming sources for KQL Databases.
**A2.** IoT sensors and Event Hubs (or Kafka / application logs).

**Q3.** Give an example of a KQL query to find devices exceeding a temperature threshold.
**A3.**

```kql
TemperatureData
| where Temperature > 80
| project DeviceId, Temperature, Timestamp
```

**Q4.** How can KQL Database data be visualized in Fabric?
**A4.** Using Power BI or Fabric dashboards with DirectQuery for real-time updates.

**Q5.** What tool in Fabric allows automated alerts for streaming data?
**A5.** Data Activator.

**Q6.** How do you compute a moving average in KQL?
**A6.** Use `summarize` with `bin(Timestamp, <interval>)` to aggregate and calculate averages over time.

**Q7.** Can you combine batch and streaming data in KQL queries?
**A7.** Yes, KQL supports hybrid queries on historical (Delta) and streaming tables.

**Q8.** What is the role of bin() in KQL?
**A8.** It groups timestamps into uniform intervals for aggregation (e.g., per minute, per hour).

---
